var random = require("./random.js");

module.exports = {
  createGenerationZero(schema, generator){
    return Object.keys(schema).reduce(function(instance, key){
      var schemaProp = schema[key];
      var values;
      switch(schemaProp.type){
        case "shuffle" :
          values = random.shuffleIntegers(schemaProp, generator); break;
        case "float" :
          values = random.createFloats(schemaProp, generator); break;
        case "integer":
          values = random.createIntegers(schemaProp, generator); break;
        default:
          throw new Error(`Unknown type ${schemaProp.type} of schema for key ${key}`);
      }
      instance[key] = values;
      return instance;
    }, { id: Math.random().toString(32) });
  },
  createCrossBreed(schema, parents, parentChooser){
    var id = Math.random().toString(32);
    return Object.keys(schema).reduce(function(crossDef, key){
      var schemaDef = schema[key];
      var values = [];
      for(var i = 0, l = schemaDef.length; i < l; i++){
        var p = parentChooser(id, key, parents);
        values.push(parents[p][key][i]);
      }
      crossDef[key] = values;
      return crossDef;
    }, {
      id: id,
      ancestry: parents.map(function(parent){
        return {
          id: parent.id,
          ancestry: parent.ancestry,
        };
      })
    });
  },
  createMutatedClone(schema, generator, parent, factor, chanceToMutate){
    return Object.keys(schema).reduce(function(clone, key){
      var schemaProp = schema[key];
      var values;
      // console.log(key, parent[key]);
      switch(schemaProp.type){
        case "shuffle" : values = random.mutateShuffle(
          schemaProp, generator, parent[key], factor, chanceToMutate
        ); break;
        case "float" : values = random.mutateFloats(
          schemaProp, generator, parent[key], factor, chanceToMutate
        ); break;
        case "integer": values = random.mutateIntegers(
          schemaProp, generator, parent[key], factor, chanceToMutate
        ); break;
        default:
          throw new Error(`Unknown type ${schemaProp.type} of schema for key ${key}`);
      }
      clone[key] = values;
      return clone;
    }, {
      id: parent.id,
      ancestry: parent.ancestry
    });
  }
}
